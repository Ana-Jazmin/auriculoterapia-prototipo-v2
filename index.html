
<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Auriculoterapia v3 — buscador + IA</title>
<style>
body{font-family:system-ui,sans-serif;margin:16px;background:#f6f5f2;color:#222}
.container{display:grid;grid-template-columns:360px 1fr;gap:16px}
.card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
label{display:block;font-weight:600;margin-top:8px}
input,textarea,button{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;margin-top:4px;font-size:0.95rem}
#ear-area{position:relative;width:360px;height:540px;margin-top:12px}
#ear-background{width:100%;height:100%;object-fit:contain;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.12)}
.point{position:absolute;width:16px;height:16px;border-radius:50%;background:#ffb74d;cursor:pointer;border:1px solid #d47b00;transition:all .12s}
.point.active{transform:scale(1.3)}
#protocol{background:#fff7e6;padding:8px;border-radius:8px;margin-top:10px;border:1px solid #ffe0b2;display:none}
.controls{display:flex;gap:8px;margin-top:10px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <label for="search">Buscar síntoma / enfermedad</label>
    <input type="text" id="search" placeholder="Ej. gastritis, insomnio, dolor de cabeza">
    <button id="iaBtn" style="margin-top:6px">Consultar IA</button>
    <div id="protocol"><strong>Protocolo sugerido:</strong><div id="protocol-text"></div></div>
    <label for="notes">Notas / protocolo personalizado</label>
    <textarea id="notes" rows="4" placeholder="Agregar instrucciones, semillas, observaciones..."></textarea>
    <div class="controls">
      <button id="applyNotes">Aplicar notas</button>
      <button id="exportPNG">Guardar PNG</button>
      <button id="exportPDF">Descargar PDF</button>
    </div>
  </div>
  <div class="card">
    <div id="ear-area">
      <img id="ear-background" src="img/oreja_realista.png" alt="Oreja realista">
      <div class="point" id="pt_head" style="top:80px;left:160px" title="Cabeza / Migraña"></div>
      <div class="point" id="pt_shenmen" style="top:120px;left:200px" title="Shenmen / Estrés"></div>
      <div class="point" id="pt_stomach" style="top:250px;left:140px" title="Estómago / Digestión"></div>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
const protocols = {"ansiedad":{points:["pt_shenmen"],text:"Shenmen. 1-2 semillas, 3-5 días, masaje 2-3 veces/día."},"insomnio":{points:["pt_shenmen"],text:"Shenmen antes de dormir, mantener 3-5 días."},"dolor de cabeza":{points:["pt_head"],text:"Cabeza. Revisar intensidad."},"gastritis":{points:["pt_stomach"],text:"Estómago. Masaje suave 2 veces/día."}};
const searchInput=document.getElementById('search');const iaBtn=document.getElementById('iaBtn');const protocolDiv=document.getElementById('protocol');const protocolText=document.getElementById('protocol-text');
searchInput.addEventListener('change',()=>{const val=searchInput.value.toLowerCase();if(protocols[val]){protocolDiv.style.display='block';protocolText.textContent=protocols[val].text;document.querySelectorAll('.point').forEach(p=>p.classList.remove('active'));protocols[val].points.forEach(id=>{document.getElementById(id)?.classList.add('active')});}else{protocolDiv.style.display='block';protocolText.textContent='No está en la lista interna. Puede consultar IA.';document.querySelectorAll('.point').forEach(p=>p.classList.remove('active'));}});
iaBtn.addEventListener('click', async ()=>{const query=searchInput.value.trim();if(!query){alert('Escribe un síntoma o enfermedad');return;}protocolDiv.style.display='block';protocolText.textContent='Consultando IA...';try{protocolText.textContent='[Demo] IA sugiere puntos según '+query;}catch(err){protocolText.textContent='Error al consultar IA: '+err;}});
document.getElementById('applyNotes').addEventListener('click',()=>{const txt=document.getElementById('notes').value;if(txt)protocolText.textContent=txt;});
document.getElementById('exportPNG').addEventListener('click',async()=>{const node=document.body;const canvas=await html2canvas(node,{scale:2});const url=canvas.toDataURL('image/png');const a=document.createElement('a');a.href=url;a.download='auriculoterapia_v3.png';a.click();});
document.getElementById('exportPDF').addEventListener('click',async()=>{const {jsPDF}=window.jspdf;const pdf=new jsPDF({unit:'mm',format:'a4'});const node=document.body;const canvas=await html2canvas(node,{scale:2});const imgData=canvas.toDataURL('image/png');const pageWidth=pdf.internal.pageSize.getWidth();const imgProps=pdf.getImageProperties(imgData);const imgWidth=pageWidth-20;const imgHeight=(imgProps.height*imgWidth)/imgProps.width;pdf.addImage(imgData,'PNG',10,10,imgWidth,imgHeight);pdf.save('auriculoterapia_v3.pdf');});
</script>
</body>
</html>
